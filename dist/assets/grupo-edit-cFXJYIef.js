import{B as E}from"./index-DCMPjbua.js";import{C as G}from"./index-Hsd0Z0_R.js";import{F as U}from"./index-I9bOp0dW.js";import{T as N}from"./index-CwPxZwdQ.js";import{T as z}from"./index-BTHsGrD3.js";import{_ as F}from"./repeater-CE5eZg-v.js";import{I as P}from"./index-BcFOD9Ey.js";import{u as q}from"./project-DZP6XSnf.js";import{C as R}from"./index-lgafHr2M.js";import{V as W}from"./VueSelect-DI5dOEtm.js";import{S as A}from"./index-DPFbVGd7.js";import{u as J,J as g,b as V,d as l,e as i,h as p,c,o as _,f as n,p as d,w as y,t as u,n as M,L as H}from"./index-BLl1OigC.js";import{C as L}from"./VueSelect.vue_vue_type_style_index_0_lang-B1s-zvio.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vue-cleave.min-DAvglPmz.js";import"./vee-validate.esm-CEUTxmiF.js";import"./av-2-D6_jNZbn.js";import"./v4-D8aEg3BZ.js";const b=J().headers(),Q={components:{Button:E,Checkbox:R,Icon:P,VueSelect:W,vSelect:L,Select:A,Card:G,Textinput:z,FromGroup:U,Textarea:N,Repeater:F,noDataTemplate:{template:'<div class="custom-no-data">Tu diseño personalizado aquí</div>'}},data(){return{shouldWatchTourId:!1,isChecked:!1,trasnportOptions:[],tourOptions:[],guiaOptions:[],idGrupo:null,bookingTourIds:[],projects:[],group:{user_id:null,tour_id:null,transport_id:null,guide_id:null,date_departure:new Date().toISOString(),code:"",correlative:null,capacity_vehicle:null,capacity_selected:null,viatic_assigned:null,is_generated:!1,is_confirmed:!1,observations:""},columnsTraspase:[{label:"",field:"abierto"},{label:"N° pax",field:"pasajero"},{label:"Vehículo",field:"vehiculo"},{label:"Turno",field:"turno"},{label:"Porforma",field:"proforma"},{label:"Responsable y Código	",field:"responsablecode"},{label:"Hotel / Ubicacion	",field:"hotelubi"},{label:"Teléfonos",field:"telephone"},{label:"Observaciones	",field:"observaciones"},{label:"Deuda	",field:"deuda"}]}},watch:{"group.transport_id":function(r,t){console.log("Nuevo valor de transport_id:",r),g.get(`https://thtbackend-production.up.railway.app/api/v1/transports/record-capacity/${r}`,b).then(s=>{console.log(s.data),this.group.capacity_vehicle=s.data.data.capacity}).catch(s=>{console.error("Error al llamar al método en el backend:",s)})},"group.tour_id":async function(r,t){this.shouldWatchTourId&&await this.fetchBookingTours(r)},$route:{immediate:!0,handler(r,t){const s=r.params.group_id;this.idGrupo=s;const a=JSON.parse(r.query.group_data);console.log("ID del grupo:",s),console.log("Data del grupo:",a),a&&(this.group.user_id=a.group_user_id||null,this.group.tour_id=a.group_tour_id||null,this.group.transport_id=a.group_transport_id||null,this.group.guide_id=a.group_guide_id||null,this.group.date_departure=a.group_date_departure||new Date().toISOString(),this.group.code=a.group_code||"",this.group.correlative=a.group_correlative||null,this.group.capacity_vehicle=a.group_capacity_vehicle||null,this.group.capacity_selected=a.group_capacity_selected||null,this.group.viatic_assigned=a.group_viatic_assigned||null,this.group.is_generated=a.group_is_generated||!1,this.group.is_confirmed=a.group_is_confirmed||!1,this.group.observations=a.group_observations||"",console.log(this.group.observations))}}},props:{groupId:{type:String,required:!0}},methods:{async fetchTransports(){try{const r=await g.get("https://thtbackend-production.up.railway.app/api/v1/transports/list",b);this.trasnportOptions=r.data.data.map(t=>({value:t.id,label:t.owner}))}catch(r){console.error("Error fetching departments:",r)}},async fetchBookingTours(r){const t=V();try{const s=await g.get(`https://thtbackend-production.up.railway.app/api/v1/bookings/booking-tours/${r}`,b);if(s.data&&s.data.data.length>0){t.info("Tours Pendientes encontrados con éxito");const a=s.data.data.map(o=>({booking_id:o.booking_id,observation:o.booking_observations,booking:{id:o.booking_id,type_booking:o.booking_type_booking,user_id:o.booking_user_id,bookingorigin_id:o.booking_bookingorigin_id,arrivalplace_id:o.booking_arrivalplace_id,client_id:o.booking_client_id,agency_id:o.booking_agency_id,origintransfer_id:o.booking_origintransfer_id,code:o.booking_code,correlative:o.booking_correlative,date_arrival:o.booking_date_arrival,time_arrival:o.booking_time_arrival,nro_pax:o.booking_nro_pax,is_reference_pax:o.booking_is_reference_pax,nro_pax_childs:o.booking_nro_pax_childs,nro_pax_adults:o.booking_nro_pax_adults,nro_pax_olds:o.booking_nro_pax_olds,reference_voucher:o.booking_reference_voucher,observations:o.booking_observations,arrival_place:o.booking_arrival_place,contact_emergency:o.booking_contact_emergency,telephone_emergency:o.booking_telephone_emergency,reference_location:o.booking_reference_location,is_igv:o.booking_is_igv,igv:o.booking_igv,is_detail_subtotaltour:o.booking_is_detail_subtotaltour,subtotal_tour:o.booking_subtotal_tour,subtotal_hotel:o.booking_subtotal_hotel,subtotal_flight:o.booking_subtotal_flight,subtotal_catalog:o.booking_subtotal_catalog,discount:o.booking_discount,total:o.booking_total,total_paid:o.booking_total_paid,total_billing:o.booking_total_billing,is_grouped:o.booking_is_grouped,description_grouped:o.booking_description_grouped,is_checkin:o.booking_is_checkin,is_checkout:o.booking_is_checkout,is_postponed:o.booking_is_postponed,user_id_postponed:o.booking_user_id_postponed,postponed_description:o.booking_postponed_description,text_amount:o.booking_text_amount,register_flight:o.booking_register_flight,is_favorite:o.booking_is_favorite,is_breakfast:o.booking_is_breakfast,nro_breakfast:o.booking_nro_breakfast,start_breakfast:o.booking_start_breakfast,end_breakfast:o.booking_end_breakfast,pending_tours:o.booking_pending_tours,origintransfer:o.booking_origintransfer,program_transfer:o.booking_program_transfer,created_at:o.booking_created_at,updated_at:o.booking_updated_at,deleted_at:o.booking_deleted_at},booking_tour:{id:o.booking_tour_id,booking_id:o.booking_tour_booking_id,tour_id:o.booking_tour_tour_id,vehicle_tour:o.booking_tour_vehicle_tour,shift_tour:o.booking_tour_shift_tour,agency_id:o.booking_tour_agency_id,operator_id:o.booking_tour_operator_id,transfer_id:o.booking_tour_transfer_id,bookingtransfer_id:o.booking_tour_bookingtransfer_id,quantity:o.booking_tour_quantity,assigned_payment:o.booking_tour_assigned_payment,delegated_payment:o.booking_tour_delegated_payment,date_assigned:o.booking_tour_date_assigned,observation:o.booking_tour_observation,is_received:o.booking_tour_is_received,is_transfer:o.booking_tour_is_transfer,is_realized:o.booking_tour_is_realized,status_realized:o.booking_tour_status_realized,date_realized:o.booking_tour_date_realized,is_paid:o.booking_tour_is_paid,is_open:o.booking_tour_is_open,is_canceled:o.booking_tour_is_canceled,created_at:o.booking_tour_created_at,updated_at:o.booking_tour_updated_at,client:{id:o.client_id,typedocument_id:o.client_typedocument_id,type_client:o.client_type_client,fullname:o.client_fullname,document:o.client_document,typeDocument:o.client_typeDocument,tradename:o.client_tradename,address:o.client_address,email:o.client_email,telephone:o.client_telephone,cellphone:o.clientcellphone,date_birthday:o.client_date_birthday,sex:o.client_sex,status:o.client_status,url_image:o.client_url_image,created_at:o.client_created_at,updated_at:o.client_updated_at,deleted_at:o.client_deleted_at,urlImageBase:o.client_urlImageBase,typeDocumentCode:o.client_typeDocumentCode,department_id:o.client_department_id,province_id:o.client_province_id,district_id:o.client_district_id},booking:{id:o.booking_id,type_booking:o.booking_type_booking,user_id:o.booking_user_id,bookingorigin_id:o.booking_bookingorigin_id,arrivalplace_id:o.booking_arrivalplace_id,client_id:o.booking_client_id,agency_id:o.booking_agency_id,origintransfer_id:o.booking_origintransfer_id,code:o.booking_code,correlative:o.booking_correlative,date_arrival:o.booking_date_arrival,time_arrival:o.booking_time_arrival,nro_pax:o.booking_nro_pax,is_reference_pax:o.booking_is_reference_pax,nro_pax_childs:o.booking_nro_pax_childs,nro_pax_adults:o.booking_nro_pax_adults,nro_pax_olds:o.booking_nro_pax_olds,reference_voucher:o.booking_reference_voucher,observations:o.booking_observations,arrival_place:o.booking_arrival_place,contact_emergency:o.booking_contact_emergency,telephone_emergency:o.booking_telephone_emergency,reference_location:o.booking_reference_location,is_igv:o.booking_is_igv,igv:o.booking_igv,is_detail_subtotaltour:o.booking_is_detail_subtotaltour,subtotal_tour:o.booking_subtotal_tour,subtotal_hotel:o.booking_subtotal_hotel,subtotal_flight:o.booking_subtotal_flight,subtotal_catalog:o.booking_subtotal_catalog,discount:o.booking_discount,total:o.booking_total,total_paid:o.booking_total_paid,total_billing:o.booking_total_billing,is_grouped:o.booking_is_grouped,description_grouped:o.booking_description_grouped,is_checkin:o.booking_is_checkin,is_checkout:o.booking_is_checkout,is_postponed:o.booking_is_postponed,user_id_postponed:o.booking_user_id_postponed,postponed_description:o.booking_postponed_description,text_amount:o.booking_text_amount,register_flight:o.booking_register_flight,is_favorite:o.booking_is_favorite,is_breakfast:o.booking_is_breakfast,nro_breakfast:o.booking_nro_breakfast,start_breakfast:o.booking_start_breakfast,end_breakfast:o.booking_end_breakfast,pending_tours:o.booking_pending_tours,origintransfer:o.booking_origintransfer,program_transfer:o.booking_program_transfer,created_at:o.booking_created_at,updated_at:o.booking_updated_at,deleted_at:o.booking_deleted_at}},tour_id:o.tour_id,tour:{id:o.tour_id,tourismcitie_id:o.tour_tourismcitie_id,shift:o.tour_shift,description:o.tour_description,comment:o.tour_comment,price_public:o.tour_price_public,price_corporate:o.tour_price_corporate,price_utility:o.tour_price_utility,created_at:o.tour_created_at,updated_at:o.tour_updated_at,deleted_at:o.tour_deleted_at,shiftour:o.tour_shiftour},client_id:o.client_id,client:{id:o.client_id,typedocument_id:o.client_typedocument_id,type_client:o.client_type_client,fullname:o.client_fullname,document:o.client_document,typeDocument:o.client_typeDocument,tradename:o.client_tradename,address:o.client_address,email:o.client_email,telephone:o.client_telephone,cellphone:o.clientcellphone,date_birthday:o.client_date_birthday,sex:o.client_sex,status:o.client_status,url_image:o.client_url_image,created_at:o.client_created_at,updated_at:o.client_updated_at,deleted_at:o.client_deleted_at,urlImageBase:o.client_urlImageBase,typeDocumentCode:o.client_typeDocumentCode,department_id:o.client_department_id,province_id:o.client_province_id,district_id:o.client_district_id}}));this.projects=a,this.bookingTourIds=this.projects.map(o=>o.booking_tour.id),console.log(this.bookingTourIds)}else t.info("Este Tour no tiene Reservas Pendientes"),this.projects=[]}catch(s){t.error("Error al cargar las reservas pendientes para este tour o Este Tour no tiene Reservas Pendientes"),console.error("Error al llamar al método en el backend:",s),this.projects=[]}},resetSelectAndTable(){this.group.tour_id=null,this.projects=[],this.group.capacity_selected=0,this.group.capacity_available=0,this.group.capacity_exceeded=0,this.shouldWatchTourId=!1,setTimeout(()=>{this.shouldWatchTourId=!0},100)},capturarValor(r){console.log("Valor capturado:",r),this.$router.push({name:"reserve-preview",params:{id:r}})},updateCapacitySelected(r){console.log(r),r.booking_tour.booking.is_grouped?this.group.capacity_selected+=r.booking_tour.booking.nro_pax:this.group.capacity_selected-=r.booking_tour.booking.nro_pax,this.group.capacity_available=this.group.capacity_vehicle-this.group.capacity_selected},async storeGroup(){const r=V();try{const t={tour_id:this.group.tour_id,transport_id:this.group.transport_id,guide_id:this.group.guide_id,date_departure:this.group.date_departure,capacity_vehicle:this.group.capacity_vehicle,capacity_selected:this.group.capacity_selected,is_generated:this.group.is_generated,is_confirmed:this.group.is_confirmed,observations:this.group.observations,bookings:this.bookingTourIds},s=await g.post(`https://thtbackend-production.up.railway.app/api/v1/groups/edit/${this.idGrupo}`,t,b),a=s.data.data.id;console.log(a),r.success("El grupo se creó exitosamente",{position:"top-right",timeout:2e3}),setTimeout(()=>{this.$router.push({name:"grupo-preview",params:{group_id:a}})},3e3),console.log(s.data)}catch(t){console.error("Error al almacenar el grupo:",t)}},getTurnoTexto(r){switch(r){case 1:return"Full Day";case 2:return"Mañana";case 3:return"Tarde";case 4:return"Noche";default:return""}},async fethById(){try{const r=await g.get(`https://thtbackend-production.up.railway.app/api/v1/groups/record-formated/${this.idGrupo}`,b);this.projects=r.data.data.group.bookings,this.bookingTourIds=this.projects.map(t=>t.id),console.log(this.projects)}catch(r){console.error("Error fetching departments:",r)}},async fetchGuides(){try{const r=await g.get("https://thtbackend-production.up.railway.app/api/v1/guides/list",b);this.guiaOptions=r.data.data.map(t=>({value:t.id,label:t.fullname}))}catch(r){console.error("Error fetching departments:",r)}},async fetchTours(){try{const r=await g.get("https://thtbackend-production.up.railway.app/api/v1/tours/list",b);this.tourOptions=r.data.data.map(t=>({value:t.id,label:t.description}))}catch(r){console.error("Error fetching departments:",r)}}},mounted(){this.shouldWatchTourId=!0},created(){this.store=q(),this.fetchTransports(),this.fetchGuides(),this.fetchTours(),this.fethById()}},X={class:"grid lg:grid-cols-5 grid-cols-1 gap-5"},Y={key:0,class:"text-red-500"},Z={class:"grid lg:grid-cols-3 grid-cols-1 gap-5 my-6"},$={key:0,class:"text-red-500"},oo={class:"flex items-center"},eo={key:0,class:"text-red-500 ml-6"},to={key:0},ro={class:"flex space-x-3 items-center text-left rtl:space-x-reverse"},ao={key:1,class:"text-slate-500 dark:text-slate-400 block min-w-[108px]"},no={key:2,class:"block min-w-[108px]"},io={key:3,class:"font-bold"},so={key:4,class:"text-slate-500 dark:text-slate-400 block min-w-[108px]"},lo={key:5,class:"block min-w-[208px]"},_o={class:"flex flex-col"},co=["onClick"],uo={key:6},po={key:7},go={class:"flex flex-col"},bo={key:8},ko={class:"font-bold"},ho={key:9},fo=n("div",{class:"text-center text-gray-500 py-4"},[n("p",null,"No hay datos disponibles en este momento."),n("p",null,"Por favor, vuelva a intentarlo más tarde.")],-1),vo={key:0,class:"text-red-500"},yo={class:"grid grid-cols-1 lg:grid-cols-4 gap-4 mt-4"},xo=n("div",{class:"lg:col-span-1"},null,-1),mo={class:"lg:col-span-3 flex justify-end"};function To(r,t,s,a,o,k){const x=c("vSelect"),m=c("VueSelect"),f=c("FromGroup"),h=c("Textinput"),C=c("flat-pickr"),S=c("Select"),I=c("Icon"),D=c("Checkbox"),j=c("vue-good-table"),B=c("Textarea"),T=c("Button"),O=c("Card");return _(),l("div",null,[i(O,{title:"Registrar grupo"},{default:p(()=>[n("div",null,[n("div",X,[i(f,{label:"Transporte"},{default:p(()=>[i(m,null,{default:p(()=>[i(x,{options:o.trasnportOptions,modelValue:o.group.transport_id,"onUpdate:modelValue":t[0]||(t[0]=e=>o.group.transport_id=e),placeholder:"Seleccione Transporte"},null,8,["options","modelValue"])]),_:1}),o.group.transport_id?d("",!0):(_(),l("span",Y,"Seleccione un transporte"))]),_:1}),i(h,{disabled:"",modelValue:o.group.capacity_vehicle,"onUpdate:modelValue":t[1]||(t[1]=e=>o.group.capacity_vehicle=e),label:"N° asientos",type:"number",placeholder:"Número de asientos"},null,8,["modelValue"]),i(h,{disabled:"",modelValue:o.group.capacity_selected,"onUpdate:modelValue":t[2]||(t[2]=e=>o.group.capacity_selected=e),label:"Seleccionados",type:"number",placeholder:"",class:"bg-green-200 dark:bg-green-700 border-green-500 dark:border-green-600 rounded-md text-center"},null,8,["modelValue"]),i(h,{disabled:"",modelValue:o.group.capacity_available,"onUpdate:modelValue":t[3]||(t[3]=e=>o.group.capacity_available=e),label:"Disponibles",type:"number",placeholder:"",class:"bg-blue-200 dark:bg-blue-700 border-blue-500 dark:border-blue-600 rounded-md text-center"},null,8,["modelValue"]),i(h,{disabled:"",modelValue:o.group.capacity_exceeded,"onUpdate:modelValue":t[4]||(t[4]=e=>o.group.capacity_exceeded=e),label:"Excedidos",type:"number",placeholder:"",class:"bg-red-200 dark:bg-red-700 border-red-500 dark:border-red-600 rounded-md text-center"},null,8,["modelValue"])]),n("div",Z,[i(f,{label:"Guía Turístico"},{default:p(()=>[i(m,null,{default:p(()=>[i(x,{options:o.guiaOptions,modelValue:o.group.guide_id,"onUpdate:modelValue":t[5]||(t[5]=e=>o.group.guide_id=e),placeholder:"Seleccione Guía"},null,8,["options","modelValue"])]),_:1}),o.group.guide_id?d("",!0):(_(),l("span",$,"Seleccione un guía de viaje"))]),_:1}),i(f,{label:"Fecha de partida",name:"d1"},{default:p(()=>[i(C,{modelValue:o.group.date_departure,"onUpdate:modelValue":t[6]||(t[6]=e=>o.group.date_departure=e),class:"form-control",id:"d1",placeholder:"Fecha de partida"},null,8,["modelValue"])]),_:1}),n("div",oo,[i(S,{options:o.tourOptions,modelValue:o.group.tour_id,"onUpdate:modelValue":t[7]||(t[7]=e=>o.group.tour_id=e),label:"Destino turístico",placeholder:"Seleccione Tour"},null,8,["options","modelValue"]),o.group.tour_id?d("",!0):(_(),l("span",eo,"Seleccione un destino turístico")),n("button",{onClick:t[8]||(t[8]=y((...e)=>k.resetSelectAndTable&&k.resetSelectAndTable(...e),["prevent"])),class:"ml-2 mt-7 p-2 btn-outline-dark border border-red-500"},[i(I,{icon:"heroicons-outline:x-circle",class:"w-6 h-6 text-red-500"})])])])]),i(j,{class:"-mx-6 mt-6 mb-5",columns:o.columnsTraspase,styleClass:" vgt-table  table-head   v-middle striped  listview",rows:this.projects,"sort-options":{enabled:!1}},{"table-row":p(e=>{var w;return[e.column.field=="abierto"?(_(),l("span",to,[n("div",ro,[i(D,{modelValue:e.row.booking_tour.booking.is_grouped,"onUpdate:modelValue":v=>e.row.booking_tour.booking.is_grouped=v,onChange:v=>k.updateCapacitySelected(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])])])):d("",!0),e.column.field=="pasajero"?(_(),l("span",ao,u(e.row.booking_tour.booking.nro_pax),1)):d("",!0),e.column.field=="vehiculo"?(_(),l("span",no,[n("span",{class:M([{"font-bold":!0,"text-blue-500":e.row.booking_tour.vehicle_tour===1,"text-yellow-500":e.row.booking_tour_vehicle_tour===2},"border rounded-full px-2 py-1"]),style:H({backgroundColor:e.row.booking_tour.vehicle_tour===1?"#90cdf4":"#fff9db",borderColor:"transparent"})},u(e.row.booking_tour.vehicle_tour===1?"Compartido":"Privado"),7)])):d("",!0),e.column.field=="turno"?(_(),l("span",io,[n("b",null,u(k.getTurnoTexto(e.row.booking_tour.vehicle_tour)),1)])):d("",!0),e.column.field=="proforma"?(_(),l("span",so,u(e.row.booking_tour.booking.reference_voucher),1)):d("",!0),e.column.field=="responsablecode"?(_(),l("span",lo,[n("div",_o,[n("div",null,u(e.row.booking_tour.client.fullname),1),n("div",{class:"text-blue-900 dark:text-blue-300 font-bold underline cursor-pointer",onClick:y(v=>k.capturarValor(e.row.booking_id),["prevent"])},u(e.row.booking_tour.booking.code),9,co)])])):d("",!0),e.column.field=="hotelubi"?(_(),l("span",uo," Test base ")):d("",!0),e.column.field=="telephone"?(_(),l("span",po,[n("div",go,[n("div",null,u(e.row.booking_tour.client.telephone),1),n("div",null,u(e.row.booking_tour.client.cellphone),1)])])):d("",!0),e.column.field=="observaciones"?(_(),l("span",bo,[n("div",ko,u((w=e.row.observation)==null?void 0:w.toUpperCase()),1)])):d("",!0),e.column.field=="deuda"?(_(),l("span",ho," S/ 0.00 ")):d("",!0)]}),"no-data":p(()=>[fo]),_:1},8,["columns","rows"]),!this.projects||this.projects.length===0?(_(),l("div",vo,"Debe seleccionar el tour para cargar los pasajeros de las reservas pendientes.")):d("",!0),i(B,{label:"Observaciones",type:"text",placeholder:"Observaciones",modelValue:o.group.observations,"onUpdate:modelValue":t[9]||(t[9]=e=>o.group.observations=e),class:"lg:w-1/2 my-6"},null,8,["modelValue"]),n("div",yo,[xo,n("div",mo,[i(T,{text:"Cancelar",btnClass:"btn-light mr-2",link:"/app/grupo"}),i(T,{onClick:y(k.storeGroup,["prevent"]),text:"Generar",btnClass:"btn-dark"},null,8,["onClick"])])])]),_:1})])}const Wo=K(Q,[["render",To]]);export{Wo as default};
