import{B as N}from"./index-DCMPjbua.js";import{C as U}from"./index-Hsd0Z0_R.js";import{F as G}from"./index-I9bOp0dW.js";import{T as A}from"./index-CwPxZwdQ.js";import{T as B}from"./index-BTHsGrD3.js";import{_ as P}from"./repeater-CE5eZg-v.js";import{I as R}from"./index-BcFOD9Ey.js";import{u as W}from"./project-DZP6XSnf.js";import{C as z}from"./index-lgafHr2M.js";import{V as M}from"./VueSelect-DI5dOEtm.js";import{S as H}from"./index-DPFbVGd7.js";import{u as L,J as h,b as C,d as l,e as n,h as _,c,o as s,f as a,p as d,w as k,t as u,n as q,L as J,F as b,m as Y,i as x}from"./index-BLl1OigC.js";import{C as K}from"./VueSelect.vue_vue_type_style_index_0_lang-B1s-zvio.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vue-cleave.min-DAvglPmz.js";import"./vee-validate.esm-CEUTxmiF.js";import"./av-2-D6_jNZbn.js";import"./v4-D8aEg3BZ.js";const f=L().headers(),X={components:{Button:N,Checkbox:z,vSelect:K,Icon:R,VueSelect:M,Select:H,Card:U,Textinput:B,FromGroup:G,Textarea:A,Repeater:P,noDataTemplate:{template:'<div class="custom-no-data">Tu diseño personalizado aquí</div>'}},data(){return{shouldWatchTourId:!0,isChecked:!1,trasnportOptions:[],tourOptions:[],currentDate:this.getCurrentDate(),guiaOptions:[],bookingTourIds:[],projects:[],group:{user_id:null,tour_id:null,transport_id:null,guide_id:null,date_departure:this.getCurrentDate(),code:"",correlative:null,capacity_vehicle:null,capacity_selected:null,viatic_assigned:null,is_generated:!1,is_confirmed:!1,observations:""},columnsTraspase:[{label:"",field:"abierto"},{label:"N° pax",field:"pasajero"},{label:"Vehículo",field:"vehiculo"},{label:"Turno",field:"turno"},{label:"Porforma",field:"proforma"},{label:"Responsable y Código	",field:"responsablecode"},{label:"Hotel / Ubicacion	",field:"hotelubi"},{label:"Teléfonos",field:"telephone"},{label:"Observaciones	",field:"observaciones"},{label:"Deuda	",field:"deuda"}]}},watch:{"group.transport_id":function(e,t){console.log("Nuevo valor de transport_id:",e),h.get(`https://thtbackend-production.up.railway.app/api/v1/transports/record-capacity/${e.value}`,f).then(i=>{console.log(i.data),this.group.capacity_vehicle=i.data.data.capacity}).catch(i=>{console.error("Error al llamar al método en el backend:",i)})},"group.tour_id":async function(e,t){this.shouldWatchTourId&&await this.fetchBookingTours(e)}},methods:{async fetchTransports(){try{const e=await h.get("https://thtbackend-production.up.railway.app/api/v1/transports/list",f);this.trasnportOptions=e.data.data.map(t=>({value:t.id,label:t.owner})),console.log(this.trasnportOptions)}catch(e){console.error("Error fetching departments:",e)}},hasHotelInfo(e){return e.hotel_tradename||e.hotel_document||e.hotel_address},getCurrentDate(){const e=new Date,t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),m=String(e.getDate()).padStart(2,"0");return`${t}-${i}-${m}`},async fetchBookingTours(e){const t=C();try{const i=await h.get(`https://thtbackend-production.up.railway.app/api/v1/bookings/booking-tours/${e}`,{...f,params:{date:this.currentDate}});i.data&&i.data.data&&i.data.data.length>0?(this.projects=i.data.data,this.bookingTourIds=this.projects.map(m=>m.booking_tour_id),t.info("Tours Pendientes encontrados con éxito"),console.log(this.bookingTourIds)):(t.info("Este Tour no tiene Reservas Pendientes"),this.projects=[])}catch(i){t.error("Error al cargar las reservas pendientes para este tour o Este Tour no tiene Reservas Pendientes"),console.error("Error al llamar al método en el backend:",i),this.projects=[]}},resetSelectAndTable(){this.group.tour_id=null,this.projects=[],this.group.capacity_selected=0,this.group.capacity_available=0,this.group.capacity_exceeded=0,this.shouldWatchTourId=!1,setTimeout(()=>{this.shouldWatchTourId=!0},100)},hasTourInformation(e){return e.tours&&Array.isArray(e.tours)&&e.tours.length>0},groupTourIdFromPivot(e){if(e.tours&&Array.isArray(e.tours)&&e.tours.length>0){const t=e.tours.find(i=>i.id===e.booking_tour_tour_id);return t?t.id:null}return null},capturarValor(e){console.log("Valor capturado:",e),this.$router.push({name:"reserve-preview",params:{id:e}})},updateCapacitySelected(e){e.booking_is_grouped?this.group.capacity_selected+=e.booking_nro_pax:this.group.capacity_selected-=e.booking_nro_pax,this.group.capacity_available=this.group.capacity_vehicle-this.group.capacity_selected},async storeGroup(){const e=C();try{const t={tour_id:this.group.tour_id,transport_id:this.group.transport_id.value,guide_id:this.group.guide_id.value,date_departure:this.group.date_departure,capacity_vehicle:this.group.capacity_vehicle,capacity_selected:this.group.capacity_selected,is_generated:this.group.is_generated,is_confirmed:this.group.is_confirmed,bookings:this.bookingTourIds};console.log(t);const i=await h.post("https://thtbackend-production.up.railway.app/api/v1/groups/create",t,f),m=i.data.data.id;console.log(m),e.success("El grupo se creó exitosamente",{position:"top-right",timeout:2e3}),setTimeout(()=>{this.$router.push({name:"grupo-preview",params:{group_id:m}})},3e3),console.log(i.data)}catch(t){console.error("Error al almacenar el grupo:",t)}},getTurnoTexto(e){switch(e){case 1:return"Full Day";case 2:return"Mañana";case 3:return"Tarde";case 4:return"Noche";default:return""}},async fetchGuides(){try{const e=await h.get("https://thtbackend-production.up.railway.app/api/v1/guides/list",f);this.guiaOptions=e.data.data.map(t=>({value:t.id,label:t.fullname}))}catch(e){console.error("Error fetching departments:",e)}},async fetchTours(){try{const e=await h.get("https://thtbackend-production.up.railway.app/api/v1/tours/list",f);this.tourOptions=e.data.data.map(t=>({value:t.id,label:t.description}))}catch(e){console.error("Error fetching departments:",e)}}},created(){this.store=W(),this.fetchTransports(),this.fetchGuides(),this.fetchTours(),console.log(this.currentDate)}},Z={class:"grid lg:grid-cols-5 grid-cols-1 gap-5"},$={key:0,class:"text-red-500"},ee={class:"grid lg:grid-cols-3 grid-cols-1 gap-5 my-6"},oe={key:0,class:"text-red-500"},te={class:"flex items-center"},re={key:0,class:"text-red-500 ml-6"},ae={key:0},le={class:"flex space-x-3 items-center text-left rtl:space-x-reverse"},se={key:1,class:"text-slate-500 dark:text-slate-400 block min-w-[108px]"},ne={key:2,class:"block min-w-[108px]"},ie={key:3,class:"font-bold"},de={key:4,class:"text-slate-500 dark:text-slate-400 block min-w-[108px]"},ce={key:5,class:"block min-w-[208px]"},ue={class:"flex flex-col"},pe=["onClick"],_e={key:6},me={key:7},ge={class:"flex flex-col"},he={key:8,class:"uppercase"},be={key:9},fe=a("div",{class:"text-center text-gray-500 py-4"},[a("p",null,"No hay datos disponibles en este momento."),a("p",null,"Por favor, vuelva a intentarlo más tarde.")],-1),ve={key:0,class:"text-red-500"},ye={class:"grid grid-cols-1 lg:grid-cols-4 gap-4 mt-4"},ke=a("div",{class:"lg:col-span-1"},null,-1),xe={class:"lg:col-span-3 flex justify-end"};function Te(e,t,i,m,r,p){const T=c("vSelect"),V=c("VueSelect"),y=c("FromGroup"),v=c("Textinput"),S=c("flat-pickr"),I=c("Select"),D=c("Icon"),j=c("Checkbox"),O=c("vue-good-table"),E=c("Textarea"),w=c("Button"),F=c("Card");return s(),l("div",null,[n(F,{title:"Registrar grupo"},{default:_(()=>[a("div",null,[a("div",Z,[n(y,{label:"Transporte"},{default:_(()=>[n(V,null,{default:_(()=>[n(T,{options:r.trasnportOptions,modelValue:r.group.transport_id,"onUpdate:modelValue":t[0]||(t[0]=o=>r.group.transport_id=o)},null,8,["options","modelValue"])]),_:1}),r.group.transport_id?d("",!0):(s(),l("span",$,"Seleccione un transporte"))]),_:1}),n(v,{disabled:"",modelValue:r.group.capacity_vehicle,"onUpdate:modelValue":t[1]||(t[1]=o=>r.group.capacity_vehicle=o),label:"N° asientos",type:"number",placeholder:"Número de asientos"},null,8,["modelValue"]),n(v,{disabled:"",modelValue:r.group.capacity_selected,"onUpdate:modelValue":t[2]||(t[2]=o=>r.group.capacity_selected=o),label:"Seleccionados",type:"number",placeholder:"",class:"bg-green-200 dark:bg-green-700 border-green-500 dark:border-green-600 rounded-md text-center"},null,8,["modelValue"]),n(v,{disabled:"",modelValue:r.group.capacity_available,"onUpdate:modelValue":t[3]||(t[3]=o=>r.group.capacity_available=o),label:"Disponibles",type:"number",placeholder:"",class:"bg-blue-200 dark:bg-blue-700 border-blue-500 dark:border-blue-600 rounded-md text-center"},null,8,["modelValue"]),n(v,{disabled:"",modelValue:r.group.capacity_exceeded,"onUpdate:modelValue":t[4]||(t[4]=o=>r.group.capacity_exceeded=o),label:"Excedidos",type:"number",placeholder:"",class:"bg-red-200 dark:bg-red-700 border-red-500 dark:border-red-600 rounded-md text-center"},null,8,["modelValue"])]),a("div",ee,[n(y,{label:"Guía Turístico"},{default:_(()=>[n(V,null,{default:_(()=>[n(T,{options:r.guiaOptions,modelValue:r.group.guide_id,"onUpdate:modelValue":t[5]||(t[5]=o=>r.group.guide_id=o),placeholder:"Seleccione Guía"},null,8,["options","modelValue"])]),_:1}),r.group.guide_id?d("",!0):(s(),l("span",oe,"Seleccione un guía de viaje"))]),_:1}),n(y,{label:"Fecha de partida",name:"d1"},{default:_(()=>[n(S,{modelValue:r.group.date_departure,"onUpdate:modelValue":t[6]||(t[6]=o=>r.group.date_departure=o),class:"form-control",id:"d1",placeholder:"Fecha de partida"},null,8,["modelValue"])]),_:1}),a("div",te,[n(I,{options:r.tourOptions,modelValue:r.group.tour_id,"onUpdate:modelValue":t[7]||(t[7]=o=>r.group.tour_id=o),label:"Destino turístico",placeholder:"Seleccione Tour"},null,8,["options","modelValue"]),r.group.tour_id?d("",!0):(s(),l("span",re,"Seleccione un destino turístico")),a("button",{onClick:t[8]||(t[8]=k((...o)=>p.resetSelectAndTable&&p.resetSelectAndTable(...o),["prevent"])),class:"ml-2 mt-7 p-2 btn-outline-dark border border-red-500"},[n(D,{icon:"heroicons-outline:x-circle",class:"w-6 h-6 text-red-500"})])])])]),n(O,{class:"-mx-6 mt-6 mb-5",columns:r.columnsTraspase,styleClass:" vgt-table  table-head   v-middle striped  listview","no-data-template":e.noDataTemplate,rows:this.projects,"sort-options":{enabled:!1}},{"table-row":_(o=>[o.column.field=="abierto"?(s(),l("span",ae,[a("div",le,[n(j,{modelValue:o.row.booking_is_grouped,"onUpdate:modelValue":g=>o.row.booking_is_grouped=g,onChange:g=>p.updateCapacitySelected(o.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])])])):d("",!0),o.column.field=="pasajero"?(s(),l("span",se,u(o.row.booking_nro_pax),1)):d("",!0),o.column.field=="vehiculo"?(s(),l("span",ne,[a("span",{class:q([{"font-bold":!0,"text-blue-500":o.row.booking_tour_vehicle_tour===1,"text-yellow-500":o.row.booking_tour_vehicle_tour===2},"border rounded-full px-2 py-1"]),style:J({backgroundColor:o.row.booking_tour_vehicle_tour===1?"#90cdf4":"#fff9db",borderColor:"transparent"})},u(o.row.booking_tour_vehicle_tour===1?"Compartido":"Privado"),7)])):d("",!0),o.column.field=="turno"?(s(),l("span",ie,[a("b",null,u(p.getTurnoTexto(o.row.booking_tour_shift_tour)),1)])):d("",!0),o.column.field=="proforma"?(s(),l("span",de,u(o.row.booking_reference_voucher),1)):d("",!0),o.column.field=="responsablecode"?(s(),l("span",ce,[a("div",ue,[a("div",null,u(o.row.client_fullname),1),a("div",{class:"text-blue-900 dark:text-blue-300 font-bold underline cursor-pointer",onClick:k(g=>p.capturarValor(o.row.booking_id),["prevent"])},u(o.row.booking_code),9,pe)])])):d("",!0),o.column.field=="hotelubi"?(s(),l("span",_e,[a("div",null,[a("div",null,u(o.row.booking_reference_location),1)])])):d("",!0),o.column.field=="telephone"?(s(),l("span",me,[a("div",ge,[a("div",null,u(o.row.client_telephone),1),a("div",null,u(o.row.client_cellphone),1)])])):d("",!0),o.column.field=="observaciones"?(s(),l("span",he,[p.hasTourInformation(o.row)?(s(!0),l(b,{key:0},Y(o.row.tours,g=>(s(),l(b,null,[g.id===p.groupTourIdFromPivot(o.row)?(s(),l(b,{key:0},[g.pivot.observation?(s(),l(b,{key:0},[x(u(g.pivot.observation),1)],64)):(s(),l(b,{key:1},[x(" - No hay información disponible ")],64))],64)):d("",!0)],64))),256)):(s(),l(b,{key:1},[x(" - No hay información disponible ")],64))])):d("",!0),o.column.field=="deuda"?(s(),l("span",be," S/ 0.00 ")):d("",!0)]),"no-data":_(()=>[fe]),_:1},8,["columns","no-data-template","rows"]),!this.projects||this.projects.length===0?(s(),l("div",ve,"Debe seleccionar el tour para cargar los pasajeros de las reservas pendientes.")):d("",!0),n(E,{label:"Observaciones",type:"text",placeholder:"Observaciones",modelValue:r.group.observations,"onUpdate:modelValue":t[9]||(t[9]=o=>r.group.observations=o),class:"lg:w-1/2 my-6"},null,8,["modelValue"]),a("div",ye,[ke,a("div",xe,[n(w,{text:"Cancelar",btnClass:"btn-light mr-2",link:"/app/grupo"}),n(w,{onClick:k(p.storeGroup,["prevent"]),text:"Generar",btnClass:"btn-dark"},null,8,["onClick"])])])]),_:1})])}const ze=Q(X,[["render",Te]]);export{ze as default};
