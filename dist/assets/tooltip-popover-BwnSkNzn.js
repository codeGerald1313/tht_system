import{D as R}from"./index-Br1mhpyn.js";import{B as S}from"./index-DOAnfiMc.js";import{C as j}from"./index-CoHYOsAq.js";import{I as O}from"./index-DxXSMpKh.js";import{I as N}from"./index-BVBpVZEi.js";import{P as B}from"./index-BXlIw-0P.js";import{w as F}from"./window-Ds9AqdYU.js";import{M as q}from"./index-D1RHiM9F.js";import{N as z,u as G,B as y,b as _,d as n,e as c,g as p,c as m,o as s,f as o,p as M,t as u,q as h,n as k,h as C,F as E,m as H,l as U}from"./index-CyQKzwXM.js";import{q as $}from"./vue-tailwind-datepicker-Dofq1ohm.js";import{r as J,d as w}from"./dayjs.min-C3PkXMSP.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{b as K}from"./menu-BlqYkBdn.js";import"./vue-cleave.min-BqMPJFk5.js";/* empty css                                              */import"./index-Jp7OXFH1.js";import"./transition-BehYXQjK.js";import"./focus-management-DKnT3RdX.js";import"./keyboard-C8YEoqI_.js";import"./use-outside-click-WivoOT8p.js";import"./hidden-1JsWbmcm.js";import"./micro-task-CxIZtCgj.js";import"./open-closed-CLDwNzJK.js";import"./use-resolve-button-type-DXZUzXBT.js";var W={exports:{}};(function(t,l){(function(d,f){t.exports=f(J())})(z,function(d){function f(i){return i&&typeof i=="object"&&"default"in i?i:{default:i}}var a=f(d),r={name:"es",monthsShort:"ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),weekdays:"domingo_lunes_martes_miércoles_jueves_viernes_sábado".split("_"),weekdaysShort:"dom._lun._mar._mié._jue._vie._sáb.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_sá".split("_"),months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),weekStart:1,formats:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un día",dd:"%d días",M:"un mes",MM:"%d meses",y:"un año",yy:"%d años"},ordinal:function(i){return i+"º"}};return a.default.locale(r,null,!0),r})})(W);const v=G().headers(),X={mixins:[F],components:{Pagination:B,InputGroup:N,Dropdown:R,Icon:O,VueTailwindDatePicker:$,Card:j,MenuItem:K,Button:S,Modal:q},data(){const t=new Date,d=new Date(t.getFullYear(),t.getMonth(),1).toISOString().split("T")[0]+" 00:00:00",a=new Date(t.getFullYear(),t.getMonth()+1,0).toISOString().split("T")[0]+" 23:59:59";return{advancedTable:[],current:1,perpage:25,show:!1,startDateVariable:"",endDateVariable:"",dateValue:{startDate:d,endDate:a},pageRange:5,searchTerm:"",actions:[{name:"edit",icon:"heroicons:pencil-square",doit:r=>{const i=r.id,g=r;this.$router.push({name:"invoice-edit",params:{id:i},query:{otherData:JSON.stringify(g)}})}},{name:"delete",icon:"heroicons-outline:trash",doit:r=>{y.post("https://thtsystemv2.tech/public/api/v1/bookings/anular",{booking_id:r.id},{...v}).then(i=>{const g=i.data.message;_().success(g,{timeout:1500}),this.listarEmpleados()}).catch(i=>{console.error("Error al eliminar empleado:",i)})}}],options:[{value:"1",label:"1"},{value:"3",label:"3"},{value:"5",label:"5"}],columns:[{label:"N° reserva	",field:"code"},{label:"Usuario r.	",field:"user_id"},{label:"Proforma",field:"reference_voucher"},{label:"Reponsable	",field:"client.fullname"},{label:"N° pax	",field:"nro_pax"},{label:"Teléfonos	",field:"client.cellphone"},{label:"Sobre tours	",field:"status"},{label:"Check-in	",field:"checking"},{label:"Total	",field:"total"},{label:"Debe	",field:"debe"},{label:"Action",field:"action"}]}},methods:{async reloadCrmTable(){y.get(`https://thtsystemv2.tech/public/api/v1/bookings/list?start_date=${this.dateValue.startDate}&end_date=${this.dateValue.endDate}`,v).then(t=>{console.log("API Response:",t.data),t.data&&Array.isArray(t.data.data)?this.advancedTable=t.data.data.map(d=>({...d,formatted_created_at:w(d.created_at).locale("es").format("DD MMM. YYYY")})):(console.error("⚠️ La estructura de la API no es la esperada:",t.data),this.advancedTable=[]),_().success(t.data.message)}).catch(t=>{console.error(t),t.response&&t.response.status===404?_().info("No se encontraron reservas dentro del rango de fechas proporcionado."):_().error("Ocurrió un error al obtener las reservas."),this.advancedTable=[]})},openModal(t){this.$router.push(`/app/reserve-preview/${t}`)}},watch:{dateValue(t,l){if(!t.startDate||!t.endDate)this.advancedTable=[];else{const d=t.startDate.split(" ")[0],f=t.endDate.split(" ")[0];y.get(`https://thtsystemv2.tech/public/api/v1/bookings/list?start_date=${d}&end_date=${f}`,v).then(a=>{console.log("API Response:",a.data),a.data&&Array.isArray(a.data.data)?this.advancedTable=a.data.data.map(r=>({...r,formatted_created_at:w(r.created_at).locale("es").format("DD MMM. YYYY")})):(console.error("⚠️ La estructura de la API no es la esperada:",a.data),this.advancedTable=[])}).catch(a=>{console.error(a),a.response&&a.response.status===404?_().info("No se encontraron reservas dentro del rango de fechas proporcionado."):_().error("Ocurrió un error al obtener las reservas."),this.advancedTable=[]})}}},mounted(){y.get(`https://thtsystemv2.tech/public/api/v1/bookings/list?start_date=${this.dateValue.startDate}&end_date=${this.dateValue.endDate}`,v).then(t=>{_().success(t.data.message),console.log("API Response:",t.data),t.data&&Array.isArray(t.data.data)?this.advancedTable=t.data.data.map(d=>({...d,formatted_created_at:w(d.created_at).locale("es").format("DD MMM. YYYY")})):(console.error("⚠️ La estructura de la API no es la esperada:",t.data),this.advancedTable=[])}).catch(t=>{console.error(t),t.response&&t.response.status===404?_().info("No se encontraron reservas dentro del rango de fechas proporcionado."):_().error("Ocurrió un error al obtener las reservas.")})}},Z={class:"md:flex pb-6 items-center"},ee=o("h6",{class:"flex-1 md:mb-0 mb-3"},"Reservas",-1),te={class:"w-[370px]"},ae={class:"-mx-6"},oe=["onClick"],se={key:0,class:"text-success-600 font-bold"},ne={key:1,class:"text-red-500 font-bold"},le={key:2,style:{"margin-top":"5px"},class:"font-bold"},re={key:3,style:{"margin-top":"5px"},class:"text-red-500 font-bold"},ie=o("br",null,null,-1),de={class:"font-bold"},ce={style:{"margin-top":"5px"}},ue={key:4,class:"text-slate-500 dark:text-slate-400"},me={key:0,class:"bg-blue-200 py-1 px-2 rounded-full text-blue-600 font-semibold inline-block",style:{width:"160px"}},_e={key:1,class:"flex items-center text-yellow-600 bg-yellow-100 py-1 px-2 rounded-full",style:{width:"120px"}},pe=o("svg",{class:"h-4 w-4 mr-2 fill-current",viewBox:"0 0 20 20"},[o("path",{"fill-rule":"evenodd",d:"M19.707 3.293a1 1 0 00-1.414 0l-10 10-4-4a1 1 0 10-1.414 1.414l5 5a1 1 0 001.414 0l11-11a1 1 0 000-1.414z","clip-rule":"evenodd"})],-1),he=o("span",{class:"flex items-center font-semibold"}," Completados ",-1),fe=[pe,he],be={key:2,class:"bg-red-200 py-1 px-2 rounded-full text-red-600 font-semibold inline-block",style:{width:"120px"}},ge={key:5,class:"text-slate-500 dark:text-slate-400"},xe={key:0,class:"flex items-center bg-green-200 py-1 px-2 rounded-full"},ye=o("span",{class:"text-green-600 font-semibold"},"Confirmado",-1),ve=[ye],ke={key:1,class:"text-red-600 font-semibold"},we={key:2,class:"text-red-600 font-semibold"},De={key:3,class:"text-red-600 font-semibold"},Me={key:6,class:"text-red-500 dark:text-slate-400 font-bold"},Ce={key:7,class:"action-btn text-end mr-3"},Te={class:"text-xl"},Ye=["onClick"],Pe={class:"text-base"},Ie={class:"py-4 px-3"},Ve={name:"client_form",id:"client_form",autocomplete:"off",class:"mx-auto space-y-4"},Ae={class:"grid grid-cols-1 lg:grid-cols-4 gap-4 mt-4"},Le=o("div",{class:"lg:col-span-1"},null,-1),Re={class:"lg:col-span-3 flex justify-end"};function Se(t,l,d,f,a,r){const i=m("InputGroup"),g=m("VueTailwindDatePicker"),x=m("Button"),D=m("Icon"),T=m("MenuItem"),Y=m("Dropdown"),P=m("Pagination"),I=m("vue-good-table"),V=m("Card"),A=m("Modal");return s(),n("div",null,[c(V,{noborder:""},{default:p(()=>[o("div",Z,[ee,o("div",{class:M(["md:flex md:space-x-3 items-center flex-none rtl:space-x-reverse",t.window.width<768?"space-x-rb":""])},[c(i,{modelValue:a.searchTerm,"onUpdate:modelValue":l[0]||(l[0]=e=>a.searchTerm=e),placeholder:"Escriba para buscar",type:"text",prependIcon:"heroicons-outline:search",merged:""},null,8,["modelValue"]),o("div",te,[c(g,{modelValue:a.dateValue,"onUpdate:modelValue":l[1]||(l[1]=e=>a.dateValue=e),"input-classes":"form-control "},null,8,["modelValue"])]),c(x,{icon:"heroicons-outline:arrows-up-down",btnClass:" btn-outline-secondary text-slate-600 dark:border-slate-700 dark:text-slate-300 font-normal btn-sm ",iconClass:"text-lg",onClick:r.reloadCrmTable},null,8,["onClick"]),c(x,{icon:"heroicons-outline:plus-sm",text:"Agregar Reserva",btnClass:" btn-dark font-normal btn-sm ",iconClass:"text-lg",link:"invoice-add"})],2)]),o("div",ae,[c(I,{columns:a.columns,styleClass:" vgt-table  centered ",rows:a.advancedTable,"sort-options":{enabled:!1},"pagination-options":{enabled:!0,perPage:a.perpage},"search-options":{enabled:!0,externalQuery:a.searchTerm}},{"table-row":p(e=>[e.column.field==="code"?(s(),n("span",{key:0,class:"font-medium w-[140px]",onClick:b=>r.openModal(e.row.id),style:{display:"flex","flex-direction":"column"}},[e.row.is_checkout!==1?(s(),n("span",se,u(e.row.code),1)):(s(),n("span",ne,u(e.row.code)+"(Anulado)",1)),e.row.is_checkout!==1?(s(),n("span",le,"Reg: "+u(e.row.formatted_created_at),1)):(s(),n("span",re,"Reg: "+u(e.row.formatted_created_at),1))],8,oe)):h("",!0),e.column.field=="user_id"?(s(),n("span",{key:1,class:"text-slate-500 dark:text-slate-400",style:k({color:e.row.is_checkout===1?"red":"inherit"})},[C(u(e.row.user.name)+" ",1),ie],4)):h("",!0),e.column.field=="client.fullname"?(s(),n("span",{key:2,class:"text-slate-500 dark:text-slate-400",style:k({color:e.row.is_checkout===1?"red":"inherit",display:"flex",flexDirection:"column"})},[o("span",null,u(e.row.client.fullname),1),o("span",de,u(e.row.client.document),1)],4)):h("",!0),e.column.field==="client.cellphone"?(s(),n("span",{key:3,style:k({color:e.row.is_checkout===1?"red":"inherit",display:"flex",flexDirection:"column"})},[o("span",null,"Teléfono: "+u(e.row.client.telephone),1),o("span",ce,"Celular: "+u(e.row.client.cellphone),1)],4)):h("",!0),e.column.field=="status"?(s(),n("span",ue,[e.row.is_checkout!==1&&e.row.pending_tours>0?(s(),n("span",me," Por Realizar "+u(e.row.pending_tours)+" Tours ",1)):e.row.is_checkout!==1?(s(),n("span",_e,fe)):(s(),n("span",be," Anulados "))])):h("",!0),e.column.field=="checking"?(s(),n("span",ge,[e.row.is_checkin===1?(s(),n("span",xe,ve)):e.row.is_checkout===1?(s(),n("span",ke," Reserva Anulada ")):e.row.is_checkin===0?(s(),n("span",we," Pendiente ")):(s(),n("span",De," Reserva Anulada "))])):h("",!0),e.column.field==="debe"?(s(),n("span",Me," S/."+u(((parseFloat(e.row.total)||0)-(parseFloat(e.row.total_paid)||0)).toFixed(2)),1)):h("",!0),e.column.field=="action"&&e.row.is_checkout!==1?(s(),n("div",Ce,[c(Y,{classMenuItems:" w-[140px]"},{menus:p(()=>[(s(!0),n(E,null,H(a.actions,(b,L)=>(s(),U(T,{key:L},{default:p(()=>[o("div",{onClick:je=>b.doit(e.row),class:M(`
                
                  ${b.name==="delete"?"bg-danger-500 text-danger-500 bg-opacity-30  hover:bg-opacity-100 hover:text-white":"hover:bg-slate-900 hover:text-white"}
                   w-full border-b border-b-gray-500 border-opacity-10 px-4 py-2 text-sm  last:mb-0 cursor-pointer first:rounded-t last:rounded-b flex  space-x-2 items-center `)},[o("span",Pe,[c(D,{icon:b.icon},null,8,["icon"])]),o("span",null,u(b.name),1)],10,Ye)]),_:2},1024))),128))]),default:p(()=>[o("div",Te,[c(D,{icon:"heroicons-outline:dots-vertical"})])]),_:2},1024)])):h("",!0)]),"pagination-bottom":p(e=>[o("div",Ie,[c(P,{total:a.advancedTable.length,current:a.current,"per-page":a.perpage,pageRange:a.pageRange,onPageChanged:l[2]||(l[2]=b=>a.current=b),pageChanged:e.pageChanged,perPageChanged:e.perPageChanged,enableSearch:"",enableSelect:"",options:a.options},{default:p(()=>[C(" > ")]),_:2},1032,["total","current","per-page","pageRange","pageChanged","perPageChanged","options"])])]),_:1},8,["columns","rows","pagination-options","search-options"])])]),_:1}),c(A,{title:"Datos de reserva | R2024-000643",label:"Modal title",activeModal:a.show,onClose:l[3]||(l[3]=e=>a.show=!1),sizeClass:"max-w-4xl"},{default:p(()=>[o("form",Ve,[o("div",Ae,[Le,o("div",Re,[c(x,{text:"Cancelar",btnClass:"btn-light mr-2"}),c(x,{type:"submit",text:"Guardar Cambios",btnClass:"btn-dark"})])])])]),_:1},8,["activeModal"])])}const rt=Q(X,[["render",Se]]);export{rt as default};
