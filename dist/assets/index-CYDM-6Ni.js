import{D as B}from"./index-Bs_uOHMv.js";import{B as A}from"./index-CvW4wJPB.js";import{C as U}from"./index-COOwjdNO.js";import{I as G}from"./index-BffMpWx5.js";import{F as H}from"./index-z1TsTTdr.js";import{I as O}from"./index-2H-cusMd.js";import{P as q}from"./index-DEP2tP3N.js";import{T as Z}from"./index-CsPMTo4u.js";import{u as j,b as z,B as y,d as a,e as l,g as d,c,o as r,f as n,w as D,p as C,h as u,t as m,q as h,F as g,m as Q,l as J}from"./index-BFn_3Gdk.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{b as W}from"./menu-BIf-sRSE.js";import"./vue-cleave.min-ClV1fVcS.js";/* empty css                                              */import"./index-BaZVwneS.js";import"./keyboard-CmTzE63w.js";import"./use-outside-click-RVZZ1L_X.js";import"./focus-management-C7_eiYjk.js";import"./use-resolve-button-type-0pot5Y2u.js";import"./open-closed-Bo1bAx4t.js";const L=j().headers(),X={components:{Pagination:q,InputGroup:O,Tooltip:Z,Dropdown:B,FromGroup:H,Icon:G,Card:U,MenuItem:W,Button:A},data(){const o=new Date,i=new Date(o.getTime()+-300*6e4).toISOString().split("T")[0];return{advancedTable:[],toast:z(),current:1,perpage:10,dateDefault:i,pageRange:5,searchTerm:"",actions:[{name:"anular",icon:"heroicons-outline:trash",doit:s=>{const _=s.id,v=s.booking_id;y.delete(`https://thtsystemv2.tech/public/api/v1/moneys/delete/${_}`,{...L,data:{booking_id:v}}).then(f=>{this.toast.success(f.data.message)}).catch(f=>{console.error("Error al eliminar el elemento",f)})}}],options:[{value:"1",label:"1"},{value:"3",label:"3"},{value:"5",label:"5"}],columns:[{label:"Tipo de Vaucher",field:"nro_voucher"},{label:"Concepto",field:"concept.description"},{label:"Responsable",field:"client.fullname"},{label:"Monto",field:"amount"},{label:"Metódo de pago",field:"payment_method.description"},{label:"Fecha del movimiento",field:"date_movement"},{label:"Action",field:"action"}]}},methods:{async reloadCrmTable(){try{await this.fetchMoneyRecords(this.dateDefault)}catch(t){console.error("Error al recargar Movimientos :",t)}},handleVerDocumento(t){y.get(`https://thtsystemv2.tech/public/api/v1/list-movements-pdf/${t}`).then(o=>{}).catch(o=>{console.error("Error al obtener la URL del PDF:",o),window.open(o.config.url,"_blank")})},showSuccessToast(t){this.toast.success(t,{position:"top-right",timeout:3e3})},showErrorToast(t){this.toast.error(t,{position:"top-right",timeout:3e3})},showInfoToast(t){this.toast.info(t,{position:"top-right",timeout:5e3})},fetchMoneyRecords(t){y.get("https://thtsystemv2.tech/public/api/v1/moneys/list-movements/",{...L,params:{date:t}}).then(o=>{Array.isArray(o.data)&&o.data.length>0?(this.advancedTable=o.data,this.showSuccessToast("¡Registros de dinero obtenidos correctamente!")):(this.advancedTable=[],this.showInfoToast("No se registraron movimientos de dinero para este día o aún no hay registros."))}).catch(o=>{console.error("Error al obtener los registros de dinero:",o),this.showErrorToast("Error al obtener los registros de dinero. Por favor, inténtalo de nuevo.")})},async downloadFile(){try{const o=(await y.get("https://thtsystemv2.tech/public/api/v1/export-money-por-dia-income-and-expense",{params:{date:this.dateDefault},responseType:"blob"})).request.responseURL,p=new URL(o),i=document.createElement("a");i.href=p,i.setAttribute("download","archivo.xlsx"),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)}catch(t){console.error("Error al descargar el archivo:",t)}}},mounted(){this.fetchMoneyRecords(this.dateDefault)},watch:{dateDefault(t,o){this.fetchMoneyRecords(t)}},computed:{filteredRows(){if(!this.searchTerm)return this.advancedTable;const t=this.searchTerm.toLowerCase();return this.advancedTable.filter(o=>{var p,i;return o.concept.description.toLowerCase().includes(t)||String(o.amount).toLowerCase().includes(t)||String((p=o.client)==null?void 0:p.fullname).toLowerCase().includes(t)||((i=o.payment_method)==null?void 0:i.description.toLowerCase().includes(t))||o.voucher.description.toLowerCase().includes(t)||o.nro_voucher.toLowerCase().includes(t)||o.date_movement.toLowerCase().includes(t)})}}},Y={class:"md:flex pb-6 items-center"},$=n("h6",{class:"flex-1 md:mb-0 mb-3"},"Movimientos de Caja",-1),ee={class:"md:flex md:space-x-3 items-center flex-none rtl:space-x-reverse"},oe={class:"-mx-6"},te=n("br",null,null,-1),ne={class:"font-bold"},se={key:0,class:"ml-1 text-red-600 font-bold"},re={key:1,class:"font-medium"},ae=n("br",null,null,-1),le={key:3,class:"font-medium"},ie=n("br",null,null,-1),ce=["innerHTML"],de=n("br",null,null,-1),me=["innerHTML"],ue=n("br",null,null,-1),he=["innerHTML"],pe={key:4,class:"font-bold"},_e={key:5,class:"flex items-center"},fe={class:"text-xl"},be=["onClick"],ge={class:"text-base"},ve=["onClick"],we=n("span",null,"Ver Documento",-1),ye={class:"py-4 px-3"};function xe(t,o,p,i,s,_){const v=c("Button"),f=c("flat-pickr"),M=c("FromGroup"),I=c("InputGroup"),x=c("Icon"),R=c("MenuItem"),V=c("Dropdown"),P=c("Tooltip"),N=c("Pagination"),E=c("vue-good-table"),F=c("Card");return r(),a("div",null,[l(F,{noborder:""},{default:d(()=>[n("div",Y,[$,n("div",ee,[l(v,{icon:"heroicons-outline:arrow-path",btnClass:" btn-outline-secondary text-slate-600 dark:border-slate-700 dark:text-slate-300 font-normal btn-sm ",iconClass:"text-lg",onClick:_.reloadCrmTable},null,8,["onClick"]),l(M,{name:"d1"},{default:d(()=>[l(f,{modelValue:s.dateDefault,"onUpdate:modelValue":o[0]||(o[0]=e=>s.dateDefault=e),class:"form-control",id:"d1",placeholder:"yyyy, dd M"},null,8,["modelValue"])]),_:1}),l(I,{modelValue:s.searchTerm,"onUpdate:modelValue":o[1]||(o[1]=e=>s.searchTerm=e),placeholder:"Ingrese el N° de voucher, ó N° de venta, ó datos del emisor o receptor",type:"text",prependIcon:"heroicons-outline:search",merged:"",class:"ml-3 w-[513px]"},null,8,["modelValue"]),l(v,{icon:"heroicons-outline:download",btnClass:"bg-green-700 text-white ml-4 text-sm",onClick:D(_.downloadFile,["prevent"]),iconClass:"text-lg"},null,8,["onClick"])])]),n("div",oe,[l(E,{columns:s.columns,styleClass:" vgt-table bordered centered ",rows:_.filteredRows,"sort-options":{enabled:!1},"pagination-options":{enabled:!0,perPage:s.perpage},"search-options":{enabled:!0,externalQuery:s.searchTerm}},{"table-row":d(e=>{var w,T,k;return[e.column.field=="nro_voucher"?(r(),a("span",{key:0,class:C(["font-medium",{"bg-red-100":e.row.is_visible===0,"text-red-600":e.row.is_visible===0}])},[u(m((w=e.row.voucher)==null?void 0:w.description)+" ",1),te,n("span",ne,m(e.row.nro_voucher),1),e.row.is_visible===0?(r(),a("span",se,"(ANULADO)")):h("",!0)],2)):h("",!0),e.column.field=="concept"?(r(),a("span",re,[u(m((T=e.row.concept)==null?void 0:T.description)+" ",1),ae])):h("",!0),e.column.field=="amount"?(r(),a("div",{key:2,class:C(["font-medium w-[100px]",{"bg-red-100":e.row.is_visible===0,"text-red-600":e.row.is_visible===0}])},[n("span",null,"S/ "+m(e.row.amount),1)],2)):h("",!0),e.column.field=="client.fullname"?(r(),a("span",le,[n("div",null,[e.row.client?(r(),a(g,{key:0},[u(" C- "+m(e.row.client.fullname),1),ie,n("span",{class:"font-bold",innerHTML:"N° Doc "+e.row.client.document},null,8,ce)],64)):e.row.employee?(r(),a(g,{key:1},[u(" E- "+m(e.row.employee.fullname),1),de,n("span",{class:"font-bold",innerHTML:"N° Doc "+e.row.employee.document},null,8,me)],64)):e.row.provider?(r(),a(g,{key:2},[u(" P- "+m(e.row.provider.fullname),1),ue,n("span",{class:"font-bold",innerHTML:"N° Doc "+e.row.provider.document},null,8,he)],64)):(r(),a(g,{key:3},[u(" No hay información disponible ")],64))])])):h("",!0),e.column.field=="payment_method.description"?(r(),a("span",pe,m((k=e.row.payment_method)==null?void 0:k.description),1)):h("",!0),e.column.field=="action"&&e.row.is_visible===1?(r(),a("span",_e,[l(V,{classMenuItems:"w-[140px]"},{menus:d(()=>[(r(!0),a(g,null,Q(s.actions,(b,S)=>(r(),J(R,{key:S},{default:d(()=>[n("div",{onClick:Ce=>b.doit(e.row),class:C(`
            ${b.name==="anular"?"bg-danger-500 text-danger-500 bg-opacity-30 hover:bg-opacity-100 hover:text-white":"hover:bg-slate-900 hover:text-white"}
            w-full border-b border-b-gray-500 border-opacity-10 px-4 py-2 text-sm last:mb-0 cursor-pointer first:rounded-t last:rounded-b flex space-x-2 items-center rtl:space-x-reverse `)},[n("span",ge,[l(x,{icon:b.icon},null,8,["icon"])]),n("span",null,m(b.name),1)],10,be)]),_:2},1024))),128))]),default:d(()=>[n("span",fe,[l(x,{icon:"heroicons-outline:dots-vertical"})])]),_:2},1024),l(P,{placement:"top",arrow:"",theme:"info-500"},{button:d(()=>[n("div",{class:"action-btn",onClick:D(b=>_.handleVerDocumento(e.row.id),["prevent"])},[l(x,{class:"text-2xl",icon:"heroicons-outline:arrow-down-on-square-stack"})],8,ve)]),default:d(()=>[we]),_:2},1024)])):h("",!0)]}),"pagination-bottom":d(e=>[n("div",ye,[l(N,{total:this.advancedTable.length,current:s.current,"per-page":s.perpage,pageRange:s.pageRange,onPageChanged:o[2]||(o[2]=w=>s.current=w),pageChanged:e.pageChanged,perPageChanged:e.perPageChanged,enableSearch:"",enableSelect:"",options:s.options},{default:d(()=>[u(" > ")]),_:2},1032,["total","current","per-page","pageRange","pageChanged","perPageChanged","options"])])]),_:1},8,["columns","rows","pagination-options","search-options"])])]),_:1})])}const qe=K(X,[["render",xe]]);export{qe as default};
