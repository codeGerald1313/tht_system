import{D as B}from"./index-DFq5MbAK.js";import{B as U}from"./index-DCMPjbua.js";import{C as G}from"./index-Hsd0Z0_R.js";import{I as H}from"./index-BcFOD9Ey.js";import{F as A}from"./index-I9bOp0dW.js";import{I as O}from"./index-DCC49QXr.js";import{P as q}from"./index-vl95iEIB.js";import{T as Z}from"./index-BAo57mri.js";import{u as j,b as z,J as v,d as r,e as l,h as d,c,o as s,f as n,w as k,n as y,i as p,t as m,p as h,F as b,m as J,l as Q}from"./index-BLl1OigC.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{b as W}from"./menu-CM83wd2-.js";import"./vue-cleave.min-DAvglPmz.js";import"./index-DPFbVGd7.js";import"./keyboard-9WePWYgZ.js";import"./use-outside-click-CPWvQZIF.js";import"./focus-management-Dc3XsveG.js";import"./use-resolve-button-type-BwPomRAb.js";import"./open-closed-0CPOhxDd.js";const D=j().headers(),X={components:{Pagination:q,InputGroup:O,Tooltip:Z,Dropdown:B,FromGroup:A,Icon:H,Card:G,MenuItem:W,Button:U},data(){const o=new Date,i=new Date(o.getTime()+-300*6e4).toISOString().split("T")[0];return{advancedTable:[],toast:z(),current:1,perpage:10,dateDefault:i,pageRange:5,searchTerm:"",actions:[{name:"anular",icon:"heroicons-outline:trash",doit:a=>{v.delete(`https://thtbackend-production.up.railway.app/api/v1/moneys/delete/${a}`,D).then(u=>{this.toast.success(u.data.message)}).catch(u=>{console.error("Error al eliminar el elemento",u)})}}],options:[{value:"1",label:"1"},{value:"3",label:"3"},{value:"5",label:"5"}],columns:[{label:"Tipo de Vaucher",field:"nro_voucher"},{label:"Concepto",field:"concept.description"},{label:"Responsable",field:"client.fullname"},{label:"Monto",field:"amount"},{label:"Metódo de pago",field:"payment_method.description"},{label:"Fecha del movimiento",field:"date_movement"},{label:"Action",field:"action"}]}},methods:{async reloadCrmTable(){try{await this.fetchMoneyRecords(this.dateDefault)}catch(t){console.error("Error al recargar Movimientos :",t)}},handleVerDocumento(t){v.get(`https://thtbackend-production.up.railway.app/api/v1/list-movements-pdf/${t}`).then(o=>{}).catch(o=>{console.error("Error al obtener la URL del PDF:",o),window.open(o.config.url,"_blank")})},showSuccessToast(t){this.toast.success(t,{position:"top-right",timeout:3e3})},showErrorToast(t){this.toast.error(t,{position:"top-right",timeout:3e3})},showInfoToast(t){this.toast.info(t,{position:"top-right",timeout:5e3})},fetchMoneyRecords(t){v.get("https://thtbackend-production.up.railway.app/api/v1/moneys/list-movements/",{...D,params:{date:t}}).then(o=>{o.data&&o.data&&o.data.length>0?(this.advancedTable=o.data,console.log(this.advancedTable),this.showSuccessToast("¡Registros de dinero obtenidos correctamente!")):(this.advancedTable=[],this.showInfoToast("No se registraron movimientos de dinero para este día o aún no hay registros."))}).catch(o=>{console.error("Error al obtener los registros de dinero:",o),this.showErrorToast("Error al obtener los registros de dinero. Por favor, inténtalo de nuevo.")})},async downloadFile(){try{const t=await v.get("https://thtbackend-production.up.railway.app/api/v1/export-money-por-dia-income-and-expense",{params:{date:this.dateDefault},responseType:"blob"});console.log(t);const o=t.request.responseURL,_=new URL(o),i=document.createElement("a");i.href=_,i.setAttribute("download","archivo.xlsx"),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),console.log("Descarga iniciada automáticamente.")}catch(t){console.error("Error al descargar el archivo:",t)}}},mounted(){this.fetchMoneyRecords(this.dateDefault)},watch:{dateDefault(t,o){console.log("Nuevo valor de dateDefault:",t),this.fetchMoneyRecords(t)}},computed:{filteredRows(){if(!this.searchTerm)return this.advancedTable;const t=this.searchTerm.toLowerCase();return this.advancedTable.filter(o=>{var _,i;return o.concept.description.toLowerCase().includes(t)||String(o.amount).toLowerCase().includes(t)||String((_=o.client)==null?void 0:_.fullname).toLowerCase().includes(t)||((i=o.payment_method)==null?void 0:i.description.toLowerCase().includes(t))||o.voucher.description.toLowerCase().includes(t)||o.nro_voucher.toLowerCase().includes(t)||o.date_movement.toLowerCase().includes(t)})}}},Y={class:"md:flex pb-6 items-center"},$=n("h6",{class:"flex-1 md:mb-0 mb-3"},"Movimientos de Caja",-1),ee={class:"md:flex md:space-x-3 items-center flex-none rtl:space-x-reverse"},oe={class:"-mx-6"},te=n("br",null,null,-1),ne={class:"font-bold"},ae={key:0,class:"ml-1 text-red-600 font-bold"},se={key:1,class:"font-medium"},re=n("br",null,null,-1),le={key:3,class:"font-medium"},ie=n("br",null,null,-1),ce=["innerHTML"],de=n("br",null,null,-1),me=["innerHTML"],ue=n("br",null,null,-1),pe=["innerHTML"],he={key:4,class:"font-bold"},_e={key:5,class:"flex items-center"},fe={class:"text-xl"},be=["onClick"],ge={class:"text-base"},ve=["onClick"],we=n("span",null,"Ver Documento",-1),ye={class:"py-4 px-3"};function xe(t,o,_,i,a,u){const x=c("Button"),L=c("flat-pickr"),M=c("FromGroup"),I=c("InputGroup"),w=c("Icon"),R=c("MenuItem"),P=c("Dropdown"),V=c("Tooltip"),N=c("Pagination"),E=c("vue-good-table"),F=c("Card");return s(),r("div",null,[l(F,{noborder:""},{default:d(()=>[n("div",Y,[$,n("div",ee,[l(x,{icon:"heroicons-outline:arrow-path",btnClass:" btn-outline-secondary text-slate-600 dark:border-slate-700 dark:text-slate-300 font-normal btn-sm ",iconClass:"text-lg",onClick:u.reloadCrmTable},null,8,["onClick"]),l(M,{name:"d1"},{default:d(()=>[l(L,{modelValue:a.dateDefault,"onUpdate:modelValue":o[0]||(o[0]=e=>a.dateDefault=e),class:"form-control",id:"d1",placeholder:"yyyy, dd M"},null,8,["modelValue"])]),_:1}),l(I,{modelValue:a.searchTerm,"onUpdate:modelValue":o[1]||(o[1]=e=>a.searchTerm=e),placeholder:"Ingrese el N° de voucher, ó N° de venta, ó datos del emisor o receptor",type:"text",prependIcon:"heroicons-outline:search",merged:"",class:"ml-3 w-[513px]"},null,8,["modelValue"]),l(x,{icon:"heroicons-outline:download",btnClass:"bg-green-700 text-white ml-4 text-sm",onClick:k(u.downloadFile,["prevent"]),iconClass:"text-lg"},null,8,["onClick"])])]),n("div",oe,[l(E,{columns:a.columns,styleClass:" vgt-table bordered centered ",rows:u.filteredRows,"sort-options":{enabled:!1},"pagination-options":{enabled:!0,perPage:a.perpage},"search-options":{enabled:!0,externalQuery:a.searchTerm}},{"table-row":d(e=>{var g,C,T;return[e.column.field=="nro_voucher"?(s(),r("span",{key:0,class:y(["font-medium",{"bg-red-100":e.row.is_visible===0,"text-red-600":e.row.is_visible===0}])},[p(m((g=e.row.voucher)==null?void 0:g.description)+" ",1),te,n("span",ne,m(e.row.nro_voucher),1),e.row.is_visible===0?(s(),r("span",ae,"(ANULADO)")):h("",!0)],2)):h("",!0),e.column.field=="concept"?(s(),r("span",se,[p(m((C=e.row.concept)==null?void 0:C.description)+" ",1),re])):h("",!0),e.column.field=="amount"?(s(),r("div",{key:2,class:y(["font-medium w-[100px]",{"bg-red-100":e.row.is_visible===0,"text-red-600":e.row.is_visible===0}])},[n("span",null,"S/ "+m(e.row.amount),1)],2)):h("",!0),e.column.field=="client.fullname"?(s(),r("span",le,[n("div",null,[e.row.client?(s(),r(b,{key:0},[p(" C- "+m(e.row.client.fullname),1),ie,n("span",{class:"font-bold",innerHTML:"N° Doc "+e.row.client.document},null,8,ce)],64)):e.row.employee?(s(),r(b,{key:1},[p(" E- "+m(e.row.employee.fullname),1),de,n("span",{class:"font-bold",innerHTML:"N° Doc "+e.row.employee.document},null,8,me)],64)):e.row.provider?(s(),r(b,{key:2},[p(" P- "+m(e.row.provider.fullname),1),ue,n("span",{class:"font-bold",innerHTML:"N° Doc "+e.row.provider.document},null,8,pe)],64)):(s(),r(b,{key:3},[p(" No hay información disponible ")],64))])])):h("",!0),e.column.field=="payment_method.description"?(s(),r("span",he,m((T=e.row.payment_method)==null?void 0:T.description),1)):h("",!0),e.column.field=="action"&&e.row.is_visible===1?(s(),r("span",_e,[l(P,{classMenuItems:"w-[140px]"},{menus:d(()=>[(s(!0),r(b,null,J(a.actions,(f,S)=>(s(),Q(R,{key:S},{default:d(()=>[n("div",{onClick:Ce=>f.doit(e.row.id),class:y(`
            ${f.name==="anular"?"bg-danger-500 text-danger-500 bg-opacity-30 hover:bg-opacity-100 hover:text-white":"hover:bg-slate-900 hover:text-white"}
            w-full border-b border-b-gray-500 border-opacity-10 px-4 py-2 text-sm last:mb-0 cursor-pointer first:rounded-t last:rounded-b flex space-x-2 items-center rtl:space-x-reverse `)},[n("span",ge,[l(w,{icon:f.icon},null,8,["icon"])]),n("span",null,m(f.name),1)],10,be)]),_:2},1024))),128))]),default:d(()=>[n("span",fe,[l(w,{icon:"heroicons-outline:dots-vertical"})])]),_:2},1024),l(V,{placement:"top",arrow:"",theme:"info-500"},{button:d(()=>[n("div",{class:"action-btn",onClick:k(f=>u.handleVerDocumento(e.row.id),["prevent"])},[l(w,{class:"text-2xl",icon:"heroicons-outline:arrow-down-on-square-stack"})],8,ve)]),default:d(()=>[we]),_:2},1024)])):h("",!0)]}),"pagination-bottom":d(e=>[n("div",ye,[l(N,{total:this.advancedTable.length,current:a.current,"per-page":a.perpage,pageRange:a.pageRange,onPageChanged:o[2]||(o[2]=g=>a.current=g),pageChanged:e.pageChanged,perPageChanged:e.perPageChanged,enableSearch:"",enableSelect:"",options:a.options},{default:d(()=>[p(" > ")]),_:2},1032,["total","current","per-page","pageRange","pageChanged","perPageChanged","options"])])]),_:1},8,["columns","rows","pagination-options","search-options"])])]),_:1})])}const Oe=K(X,[["render",xe]]);export{Oe as default};
